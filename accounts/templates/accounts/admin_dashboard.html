{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="admin-container">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
    <div class="sidebar-header">
        <div class="logo">
            <i class="fas fa-plane"></i>
            <span class="logo-text">Velaris</span>
        </div>
        <button id="toggleSidebar" class="btn btn-light">
            <i class="fas fa-bars"></i>
        </button>
    </div>
        
        <nav class="sidebar-nav">
            <div class="nav-item" id="darkModeToggle">
                <i class="fas fa-moon"></i>
                <span>Modo Oscuro</span>
            </div>

            <a href="#" class="nav-item active">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            <a href="{% url 'admin_flight_list' %}" class="nav-item">
                <i class="fas fa-plane-departure"></i>
                <span>Vuelos</span>
            </a>
            
            <a href="{% url 'admin_user_list' %}" class="nav-item">
                <i class="fas fa-users"></i>
                <span>Usuarios</span>
            </a>
            <a href="{% url 'admin_airport_list' %}" class="nav-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>Aeropuertos</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <a href="{% url 'logout' %}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>Cerrar sesión</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Header -->
        <header class="admin-header">
            <div class="user-greeting">
                <span>Hola, {{ user.username }}</span>
            </div>
            <div class="header-controls">
                <div class="user-profile">
                    <i class="fas fa-user-circle"></i>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-content">
                    <h3>{{ stats.active_flights }}</h3>
                    <p>Vuelos Activos</p>
                </div>
                <i class="fas fa-plane stat-icon"></i>
                <a href="{% url 'admin_flight_list' %}" class="stat-link">Ver todos →</a>
            </div>
            
            <!-- <div class="stat-card">
                <div class="stat-content">
                    <h3>{{ stats.today_bookings }}</h3>
                    <p>Reservas Hoy</p>
                </div>
                <i class="fas fa-calendar-check stat-icon"></i>
                <a href="#" class="stat-link">Ver reporte →</a>
            </div> -->
            
            <div class="stat-card">
                <div class="stat-content">
                    <h3>{{ stats.total_users }}</h3>
                    <p>Usuarios Registrados</p>
                </div>
                <i class="fas fa-users stat-icon"></i>
                <a href="{% url 'admin_user_list' %}" class="stat-link">Gestionar →</a>
            </div>
            
            <div class="stat-card">
                <div class="stat-content">
                    <h3>${{ stats.today_income|floatformat:2 }}</h3>
                    <p>Ingresos Hoy</p>
                </div>
                <i class="fas fa-dollar-sign stat-icon"></i>
                <a href="#" class="stat-link">Ver detalles →</a>
            </div>
        </div>

        <!-- Tables Section -->
        <div class="content-grid">
            <!-- Próximos Vuelos -->
            <div class="content-card">
                <div class="card-header">
                    <h3>Próximos Vuelos</h3>
                    <div class="card-actions">
                        <a href="{% url 'admin_flight_list' %}" class="action-link">Ver todos</a>
                        <a href="{% url 'admin_create_flight' %}" class="action-link">Nuevo vuelo</a>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Número</th>
                            <th>Ruta</th>
                            <th>Fecha</th>
                            <th>Asientos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for flight in recent_flights %}
                        <tr>
                            <td>{{ flight.flight_number }}</td>
                            <td>{{ flight.departure_airport.code }} → {{ flight.arrival_airport.code }}</td>
                            <td>{{ flight.departure_time|date:"d/m H:i" }}</td>
                            <td>
                                <div class="progress-bar">
                                    {% with percent=flight.get_seat_percentage %}
                                        {% if percent > 75 %}
                                            {% with "progress-green" as color_class %}
                                                <div class="progress-fill {{ color_class }}" style="--percent: {{ percent }}%;">
                                                    {{ flight.available_seats }}/{{ flight.total_seats }}
                                                </div>
                                            {% endwith %}
                                        {% elif percent > 40 %}
                                            {% with "progress-yellow" as color_class %}
                                                <div class="progress-fill {{ color_class }}" style="--percent: {{ percent }}%;">
                                                    {{ flight.available_seats }}/{{ flight.total_seats }}
                                                </div>
                                            {% endwith %}
                                        {% else %}
                                            {% with "progress-red" as color_class %}
                                                <div class="progress-fill {{ color_class }}" style="--percent: {{ percent }}%;">
                                                    {{ flight.available_seats }}/{{ flight.total_seats }}
                                                </div>
                                            {% endwith %}
                                        {% endif %}
                                    {% endwith %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Últimas Reservas -->
            <div class="content-card">
                <div class="card-header">
                    <h3>Últimas Reservas</h3>
                    <div class="card-actions">
                        <a href="#" class="action-link">Exportar</a>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Usuario</th>
                            <th>Vuelo</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for booking in recent_bookings %}
                        <tr>
                            <td>{{ booking.booking_reference }}</td>
                            <td>{{ booking.user.get_short_name }}</td>
                            <td>{{ booking.flight.flight_number }}</td>
                            <td>
                                <span class="status-badge 
                                    {% if booking.status == 'CONFIRMED' %}confirmed
                                    {% elif booking.status == 'PENDING' %}pending
                                    {% else %}canceled{% endif %}">
                                    {{ booking.get_status_display }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Aeropuertos Section -->
        <div class="content-card">
            <div class="card-header">
                <h3>Aeropuertos</h3>
                <div class="card-actions">
                    <a href="{% url 'admin_airport_create' %}" class="action-link">Nuevo Aeropuerto</a>
                </div>
            </div>
            <div class="airports-grid">
                {% for airport in airports %}
                <div class="airport-card">
                    <div class="airport-info">
                        <h4>{{ airport.code }}</h4>
                        <p>{{ airport.name }}</p>
                        <small>{{ airport.city }}, {{ airport.country }}</small>
                    </div>
                    <div class="airport-actions">
                        <a href="#" class="action-link">Editar</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
</div>

<style>
/* Estilos personalizados */
.admin-container {
    display: flex;
    min-height: 100vh;
    background: #f5f6fa;
}

.admin-sidebar {
    width: 250px;
    background: #ffffff;
    padding: 1.5rem;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    position: relative;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}

.data-table th,
.data-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.progress-bar {
    height: 20px;
    background: #eee;
    border-radius: 10px;
    overflow: hidden;
}
.progress-green {
    background-color: #4CAF50;
}
.progress-yellow {
    background-color: #FFC107;
}
.progress-red {
    background-color: #F44336;
}
.progress-fill {
    height: 100%;
    width: var(--percent, 0%);
    transition: width 0.3s ease-in-out;
}
.status-badge {
    padding: 4px 8px;
    border-radius: 20px;
    font-size: 0.8em;
}

.status-badge.confirmed { background: #4CAF50; color: white; }
.status-badge.pending { background: #FFC107; color: black; }
.status-badge.canceled { background: #F44336; color: white; }

/* Estilos generales */
.admin-container {
    display: flex;
    min-height: 100vh;
    background: #f5f6fa;
    font-family: 'Segoe UI', system-ui, sans-serif;
}

/* Sidebar */
.admin-sidebar {
    width: 250px;
    background: #ffffff;
    padding: 1.5rem;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    position: fixed;
    height: 100%;
}

.sidebar-header {
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #eee;
    margin-bottom: 1.5rem;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 1.25rem;
    color: #2c3e50;
}

.logo i {
    font-size: 1.8rem;
    color: #3498db;
}

.sidebar-nav {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 8px;
    color: #7f8c8d;
    text-decoration: none;
    transition: all 0.2s ease;
}

.nav-item:hover {
    background: #f8f9fa;
    color: #3498db;
}

.nav-item.active {
    background: #3498db20;
    color: #3498db;
    font-weight: 500;
}

.nav-item i {
    width: 24px;
    text-align: center;
}

.sidebar-footer {
    margin-top: auto;
    padding-top: 1.5rem;
    border-top: 1px solid #eee;
}

/* Contenido principal */
.admin-main {
    flex: 1;
    margin-left: 250px;
    padding: 2rem;
}

/* Header */
.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1rem 0;
}

.search-container {
    position: relative;
    width: 300px;
}

.search-container i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #95a5a6;
}

.search-container input {
    width: 100%;
    padding: 10px 16px 10px 40px;
    border: 1px solid #eee;
    border-radius: 8px;
    background: #fff;
    font-size: 14px;
    transition: border-color 0.2s ease;
}

.search-container input:focus {
    outline: none;
    border-color: #3498db;
}

.header-controls {
    display: flex;
    align-items: center;
    gap: 20px;
}

.user-profile i {
    font-size: 2rem;
    color: #7f8c8d;
    cursor: pointer;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    position: relative;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: transform 0.2s ease;
}

.stat-card:hover {
    transform: translateY(-3px);
}

.stat-content h3 {
    font-size: 1.8rem;
    color: #2c3e50;
    margin-bottom: 8px;
}

.stat-content p {
    color: #7f8c8d;
    margin-bottom: 16px;
}

.stat-icon {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    font-size: 1.8rem;
    color: #3498db30;
}

.stat-link {
    display: block;
    color: #3498db;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
}
.admin-sidebar.collapsed {
    width: 70px;
}

.admin-sidebar.collapsed .sidebar-nav span,
.admin-sidebar.collapsed .logo span,
.admin-sidebar.collapsed .sidebar-footer span {
    display: none;
}

.admin-main.expanded {
    margin-left: 70px;
}

/* Tablas */
.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.content-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.card-header h3 {
    color: #2c3e50;
    font-size: 1.2rem;
}

.card-actions {
    display: flex;
    gap: 1rem;
}

.action-link {
    color: #3498db;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}

.data-table th {
    text-align: left;
    padding: 12px;
    color: #7f8c8d;
    font-weight: 500;
    border-bottom: 2px solid #eee;
}

.data-table td {
    padding: 12px;
    border-bottom: 1px solid #eee;
    color: #2c3e50;
}

.data-table tr:hover td {
    background: #f8f9fa;
}

/* Progress Bar */
.progress-bar {
    height: 24px;
    background: #ecf0f1;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    border-radius: 12px;
    font-size: 0.75rem;
    color: white;
    display: flex;
    align-items: center;
    padding-left: 12px;
    transition: width 0.3s ease;
}

/* Status Badges */
.status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-badge.confirmed { background: #27ae60; color: white; }
.status-badge.pending { background: #f1c40f; color: black; }
.status-badge.canceled { background: #e74c3c; color: white; }

/* Aeropuertos */
.airports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.airport-card {
    background: #fff;
    border-radius: 12px;
    padding: 1.2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    transition: transform 0.2s ease;
}

.airport-card:hover {
    transform: translateY(-3px);
}

.airport-info h4 {
    color: #2c3e50;
    margin-bottom: 4px;
    font-size: 1.1rem;
}

.airport-info p {
    color: #7f8c8d;
    margin-bottom: 4px;
}

.airport-info small {
    color: #bdc3c7;
    font-size: 0.85rem;
}

.airport-actions {
    margin-top: 1rem;
    text-align: right;
}
body.dark-mode {
    background-color: #121212;
    color: #f0f0f0;
}

body.dark-mode .admin-sidebar {
    background-color: #1e1e1e;
    color: #f0f0f0;
}

body.dark-mode .admin-main {
    background-color: #1a1a1a;
    color: #ffffff;
}

body.dark-mode .stat-card,
body.dark-mode .content-card {
    background-color: #2a2a2a;
    color: #ffffff;
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.05);
}

body.dark-mode .nav-item {
    color: #cccccc;
}

body.dark-mode .nav-item.active,
body.dark-mode .nav-item:hover {
    background-color: #333;
    color: #1abc9c;
}

body.dark-mode .data-table th,
body.dark-mode .data-table td {
    color: #eee;
    border-color: #333;
}
body.dark-mode .stat-card,
body.dark-mode .content-card {
    background: #2d2d2d;
    border: 1px solid #404040;
}

body.dark-mode .data-table {
    background: #252525;
}

body.dark-mode .stat-link,
body.dark-mode .action-link {
    color: #4dabf7;
}

/* Aeropuertos más populares (ESTILO MEJORADO) */
.airports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.airport-card {
    position: relative;
    overflow: hidden;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.airport-card::after {
    content: attr(data-popularity);
    position: absolute;
    top: 10px;
    right: -30px;
    background: #4dabf7;
    color: white;
    padding: 5px 30px;
    transform: rotate(45deg);
    font-size: 0.8em;
}

body.dark-mode .airport-card {
    background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
}
footer {
    display: none !important;
}

/* Responsive */
@media (max-width: 768px) {
    .admin-sidebar {
        position: fixed;
        z-index: 1000;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .admin-sidebar.collapsed {
        transform: translateX(0);
        width: 70px;
    }
    
    .admin-main.expanded {
        margin-left: 0;
    }
    
    .admin-sidebar.collapsed .nav-item span {
        display: none;
    }

    .admin-main {
        margin-left: 0;
        padding: 1.5rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .admin-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .search-container {
        width: 100%;
    }
}

/* Transiciones */
a, button, .nav-item, .stat-card {
    transition: all 0.2s ease;
}
</style>
<script>
// Scripts actualizados (responsive y dark mode)
document.addEventListener("DOMContentLoaded", () => {
    // Toggle Sidebar Responsive
    const toggleSidebar = () => {
        const sidebar = document.querySelector('.admin-sidebar');
        const main = document.querySelector('.admin-main');
        sidebar.classList.toggle('collapsed');
        main.classList.toggle('expanded');
        localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
    };

    // Dark Mode
    const toggleDarkMode = () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    };

    // Cargar estado inicial
    if (localStorage.getItem('sidebarCollapsed') === 'true') toggleSidebar();
    if (localStorage.getItem('darkMode') === 'true') toggleDarkMode();

    // Event Listeners
    document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
    document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
    
    // Responsive para móviles
    window.matchMedia("(max-width: 768px)").addEventListener("change", e => {
        if (e.matches) toggleSidebar();
    });
});
</script>
{% endblock %} 